<!DOCTYPE html>
<html lang="en">
	<head>
		<link
			rel="stylesheet"
			type="text/css"
			href="{{ url_for('static', filename='css/buyreq.css') }}"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="{{ url_for('static', filename='css/styles.css') }}"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous"
		/>
		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous"
		/>

		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>Checkout</title>
	</head>
	<body>
		<form
			method="post"
			action="{{ url_for('home.book_buy', user_id=user_id, book_id=matching_book.book_id) }}"
		>
			<div>{% include 'partials/navbar.html' %}</div>
			{% if matching_book %}
			<div
				class="order-container"
				style="margin-top: -100px"
			>
				<div class="delivery-box">
					<div class="title">Delivery Address</div>
					<!-- Make "Add New Address" clickable -->
					<div
						id="addAddressButton"
						data-toggle="modal"
						data-target="#addAddressModal"
						style="cursor: pointer"
					>
						<div class="add-address">
							<div class="add-address-icon">
								<a
									href="{{ url_for('home.add_address', user_id=user_id, book_id=matching_book.book_id) }}"
								>
									<img
										src="https://res.cloudinary.com/dclxaugvd/image/upload/v1702577474/bookster/icon-park-outline_add_1_vgeyck.png"
										alt="Add Address Icon"
									/>
								</a>
							</div>
							<div class="add-address-text">Add New Address</div>
						</div>
					</div>
				</div>

				<div class="order-box">
					<table class="order-details-table">
						<thead>
							<tr>
								<th></th>
								<th>Item</th>
								<th>Price</th>
								<th>Quantity</th>
								<th>Item Subtotal</th>
							</tr>
						</thead>
						<tbody>
							<!-- Add your order details rows here -->

							<tr>
								<td>
									<img
										src="{{ book_detail.cloudinary_url or 'https://res.cloudinary.com/dclxaugvd/image/upload/v1702621916/bookster/COVER_BOOK_1_zdzcec.png' }}"
										alt="Product Image"
										style="width: 87px; height: 115px; object-fit: cover"
									/>
								</td>

								<td>
									{% if matching_book.book_title|length > 30 %} {{
									matching_book.book_title[:30] }}... {% else %} {{
									matching_book.book_title }} {% endif %}
								</td>
								<td>₱{{ book_detail.selling_price }}</td>
								<td>
									<div>
										<input
											type="number"
											name="quantity"
											id="order_quantity"
											min="1"
											value="1"
											max="{{book_detail.quantity}}"
										/>
									</div>
								</td>
								<td id="totalPrice">₱{{ book_detail.selling_price }}</td>
							</tr>

							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td>
									Order total (<span id="orderQuantity">1</span> item{% if
									quantity != 1 %}s{% endif %})
								</td>
								<td id="orderTotal">₱{{ book_detail.selling_price }}</td>
							</tr>
							<!-- Add more rows as needed -->
						</tbody>
					</table>
				</div>

				<div class="payment-box">
					<div class="payment-method">
						<div class="paymenttitle">Payment Method</div>
						<div class="form-check">
							<input
								class="form-check-input"
								type="radio"
								name="paymentMethod"
								id="cashOnDelivery"
								value="cashOnDelivery"
							/>
							<div class="label-container">
								<label
									class="form-check-label"
									style="font-size: 20px"
									for="cashOnDelivery"
									>Cash on Delivery</label
								>
							</div>
						</div>
					</div>

					<div class="order-totals">
						<div class="order-total-item">
							<span>Item Subtotal:</span>
							<span>$39.98</span>
						</div>
						<div class="order-total-item">
							<span style="margin-top: 9px">Total Payment:</span>
							<span style="font-size: 30px; font-weight: 20px">P413</span>
							<!-- Add the total payment dynamically -->
						</div>
					</div>
					<div class="place-order-btn">
						<button
							type="submit"
							class="button btn btn-primary"
						>
							Place Order
						</button>
					</div>
				</div>
			</div>
			{% endif %}
		</form>
		<script>
			// Function to update order total based on quantity
			function updateOrderTotal() {
				// Get the quantity value
				var quantity = parseInt(
					document.getElementById("order_quantity").value
				);

				// Get the price per item
				var pricePerItem = parseFloat(
					document.getElementById("totalPrice").innerText.replace("₱", "")
				);

				// Calculate the new order total
				var newOrderTotal = quantity * pricePerItem;

				// Update the order total in the HTML
				document.getElementById("orderTotal").innerText =
					"₱" + newOrderTotal.toFixed(2);

				// Update the order quantity in the HTML
				document.getElementById("orderQuantity").innerText = quantity;

				// Update the pluralization of 'item' based on quantity
				var pluralSuffix = quantity !== 1 ? "s" : "";
				document.getElementById("orderQuantityPlural").innerText = pluralSuffix;
			}

			// Attach the updateOrderTotal function to the input event of the quantity input field
			document
				.getElementById("order_quantity")
				.addEventListener("input", updateOrderTotal);

			// Initial call to updateOrderTotal to set the initial values
			updateOrderTotal();
		</script>
	</body>
</html>
